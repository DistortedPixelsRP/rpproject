<!doctype html>
<html>
<head>
	<meta charset="utf-8"/>
	<link href="index.css" rel="stylesheet">
</head>

<body>
	<div class="container">
		<div class="head">
			Men√∫ de crafteo
		</div>
		<div class="subtitle">
			Selecciona el item a craftear
		</div>
		<div class="ingredients iqdropdown">
			<select class="iqdropdown-selection" id="dropdown">
				<option value="0" disabled selected>Selecciona una receta</option>
			</select>
		</div>
		<div id='ingredientes' class="cajaingredients">

		</div>
		<button type="button" id="btn"><strong>CRAFTEAR ITEM</strong></button>
	</div>
	<script src="nui://game/ui/jquery.js" type="text/javascript"></script>
	<script type="text/javascript">
		var array = {};
		function craftItems() {
			
		}
		$(document).ready(function () {
			$("#btn").prop('disabled', true);

			$("#btn").click(function(){
				var itemname = $('#dropdown').val();
				$.post('http://salty_crafting/craftItemNUI', JSON.stringify(itemname));
				$.post('http://salty_crafting/NUIFocusOff');
			});

			$("#dropdown").change(function(){
				$("#ingredientes").html("<ul id='lista'></ul>");
				$("#btn").prop('disabled', false);
				var ingredientes = {};
				var data = $('#dropdown').val();

				for (var i=0; i < array.length; i++){
					if (array[i].value === data){
						var ingredientes = array[i].ingredients;
					}
				}
				
				for (var u=0; u < ingredientes.length; u++){
					$('#lista').append('<li><b>'+ ingredientes[u].name + ':</b> '+ ingredientes[u].quantity +' unidades.</li>');
				}

				
			})
			
		});
		$(function(){
			window.onload = function(e){
				window.addEventListener('message', function(event){
					var item = event.data;
					if (item.display === true) {
						array = item.recipes;
						$("#dropdown").empty();
						$("#ingredientes").empty();
						$("#dropdown").append("<option value='0' selected disabled>Seleccione uno</option>");
						for (var i = 0; i < array.length; i++) {
							//var obj = array[i];
							//$( ".iqdropdown-menu" ).append('<li data-id="' + obj.name + '" data-maxcount=' + obj.count + '><div> ' + obj.label + '<span>Add ' + obj.label + ' to your ingredients list.</span> </div></li>');
							//$( ".iqdropdown-menu" ).append('<li data-id="' + obj.name + '" data-maxcount=' + obj.count + '><div> ' + obj.label + '<span>Add ' + obj.label + ' to your ingredients list.</span> </div></li>');
							//console.log(obj)
							$('#dropdown').append(new Option(array[i].name, array[i].value));
						}
						//$(".ingredients").iqDropdown({
						//	selectionText: 'ingredient',
						//	textPlural: 'ingredients',
						//	onChange: function (id, count, totalItems) {
						//		ingredients[id] = count
						//	},
						//});
						
						$('.container').show()
					} else if (item.display === false) {
						$('.container').hide();
					}
				});
				
				document.onkeyup = function (data) {
					if (data.which == 27) { // Escape key
						$.post('http://salty_crafting/NUIFocusOff');
					}
				};
			};
		});
	</script> 

</body>
</html>
